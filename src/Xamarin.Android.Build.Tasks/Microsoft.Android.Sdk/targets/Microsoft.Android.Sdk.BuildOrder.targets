<!--
***********************************************************************************************
Microsoft.Android.Sdk.BuildOrder.targets

This file contains the .NET 6+ setup for any $(FooDependsOn)
properties that determine build ordering.

***********************************************************************************************
-->

<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <_AndroidBuildDependsOn>
      _ValidateLinkMode;
      _CheckNonIdealConfigurations;
      _SetupMSBuildAllProjects;
      _SetupDesignTimeBuildForBuild;
      AndroidPrepareForBuild;
      _BuildAndroidGradleProjects;
      _CategorizeAndroidLibraries;
      _CreatePropertiesCache;
      _CleanIntermediateIfNeeded;
      _CheckProjectItems;
      _CheckForContent;
      _CheckForObsoleteFrameworkAssemblies;
      _ValidateAndroidPackageProperties;
      AddLibraryJarsToBind;
      _CollectJavaSourceForBinding;
      _CompileBindingJava;
    </_AndroidBuildDependsOn>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(AndroidApplication)' == 'true' And '$(_AndroidRuntime)' == 'CoreCLR' ">
    <_NativeRuntimeLinking>_LinkNativeRuntime</_NativeRuntimeLinking>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(AndroidApplication)' == 'True' ">
    <BuildDependsOn>
      $(_AndroidBuildDependsOn);
      $(BuildDependsOn);
      _CompileDex;
      $(_AfterCompileDex);
    </BuildDependsOn>
    <!--
      Outside IDEs: we need to produce an .apk/.aab and sign
      Inside IDEs: the Install target produces .apk/.aab files & signs
    -->
    <BuildDependsOn Condition=" '$(BuildingInsideVisualStudio)' != 'true' ">
      $(BuildDependsOn);
      _CopyPackage;
      _Sign;
      _CreateUniversalApkFromBundle;
    </BuildDependsOn>
    <IncrementalCleanDependsOn>
      _PrepareAssemblies;
      _CompileDex;
      $(_AfterCompileDex);
      _AddFilesToFileWrites;
      $(IncrementalCleanDependsOn);
    </IncrementalCleanDependsOn>
    <_PackageForAndroidDependsOn>
      Build;
      _CopyPackage;
    </_PackageForAndroidDependsOn>
    <_PrepareBuildApkDependsOnTargets>
      _SetLatestTargetFrameworkVersion;
      _GetLibraryImports;
      _RemoveRegisterAttribute;
      _ResolveAssemblies;
      _ResolveSatellitePaths;
      _CreatePackageWorkspace;
      _LinkAssemblies;
      _AfterILLinkAdditionalSteps;
      _GenerateJavaStubs;
      _ManifestMerger;
      _ConvertCustomView;
      $(_AfterConvertCustomView);
      $(AfterGenerateAndroidManifest);
      _ReadAndroidManifest;
      _CompileJava;
      _CreateApplicationSharedLibraries;
      $(_NativeRuntimeLinking);
      _CompileDex;
      $(_AfterCompileDex);
      _CreateBaseApk;
      _PrepareAssemblies;
      _ResolveSatellitePaths;
      _CheckApkPerAbiFlag;
      _LintChecks;
      _IncludeNativeSystemLibraries;
      _CheckGoogleSdkRequirements;
      BuildAndroidAssetPacks;
    </_PrepareBuildApkDependsOnTargets>
  </PropertyGroup>

  <PropertyGroup>
    <InstallDependsOnTargets>
      SignAndroidPackage;
      _DeployApk;
      _DeployAppBundle;
    </InstallDependsOnTargets>
    <UninstallDependsOnTargets>
      AndroidPrepareForBuild;
      _Uninstall
    </UninstallDependsOnTargets>
    <!-- When inside an IDE, Build has just been run. This is a minimal list of targets for SignAndroidPackage. -->
    <_MinimalSignAndroidPackageDependsOn>
      BuildOnlySettings;
      _CreatePropertiesCache;
      ResolveReferences;
      PrepareResources;
      CreateSatelliteAssemblies;
      _CopyPackage;
      _Sign;
      _CreateUniversalApkFromBundle;
    </_MinimalSignAndroidPackageDependsOn>
    <SignAndroidPackageDependsOn Condition=" '$(BuildingInsideVisualStudio)' != 'true' ">
      Build;
      Package;
      _Sign;
      _CreateUniversalApkFromBundle;
    </SignAndroidPackageDependsOn>
    <SignAndroidPackageDependsOn Condition=" '$(BuildingInsideVisualStudio)' == 'true' ">
      $(_MinimalSignAndroidPackageDependsOn);
    </SignAndroidPackageDependsOn>
    <!-- This should function similar to SignAndroidPackage inside VS plus also deploy -->
    <DeployToDeviceDependsOnTargets Condition=" '$(_XASupportsFastDev)' == 'true' ">
      $(_MinimalSignAndroidPackageDependsOn);
      _Upload;
    </DeployToDeviceDependsOnTargets>
    <DeployToDeviceDependsOnTargets Condition=" '$(_XASupportsFastDev)' != 'true' ">
      $(_MinimalSignAndroidPackageDependsOn);
      _DeployApk;
      _DeployAppBundle;
    </DeployToDeviceDependsOnTargets>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(AndroidApplication)' != 'True' ">
    <BuildDependsOn>
      $(_AndroidBuildDependsOn);
      $(BuildDependsOn);
      _CalculateAssetsWithAssetPackMetaData;
      _CreateAar;
    </BuildDependsOn>
    <IncrementalCleanDependsOn>
      _AddFilesToFileWrites;
      $(IncrementalCleanDependsOn);
    </IncrementalCleanDependsOn>
  </PropertyGroup>

  <PropertyGroup>
    <CoreResolveReferencesDependsOn>
      _CreatePropertiesCache;
      _SeparateAppExtensionReferences;
      $(ResolveReferencesDependsOn);
      _AddAndroidCustomMetaData;
      _ResolveAars;
    </CoreResolveReferencesDependsOn>
    <ResolveReferencesDependsOn>
      $(CoreResolveReferencesDependsOn);
      UpdateAndroidResources;
      UpdateAndroidInterfaceProxies;
      _CheckForInvalidDesignerConfig;
    </ResolveReferencesDependsOn>
    <_UpdateAndroidResourcesDependsOn>
      $(CoreResolveReferencesDependsOn);
      _CreatePropertiesCache;
      _CheckForDeletedResourceFile;
      _ComputeAndroidResourcePaths;
      _UpdateAndroidResgen;
      _CreateAar;
    </_UpdateAndroidResourcesDependsOn>
    <CompileDependsOn>
      _SetupMSBuildAllProjects;
      _SetupDesignTimeBuildForCompile;
      AndroidPrepareForBuild;
      _IncludeLayoutBindingSources;
      AddLibraryJarsToBind;
      _CollectLibrariesToBind;
      _SetAndroidGenerateManagedBindings;
      ExportJarToXml;
      GenerateBindings;
      _CollectGeneratedManagedBindingFiles;
      _ClearGeneratedManagedBindings;
      AddBindingsToCompile;
      $(CompileDependsOn);
      _BuildResourceDesigner;
      _AddResourceDesignerFiles;
      _CheckAndroidHttpClientHandlerType;
    </CompileDependsOn>
    <CoreCompileDependsOn>
      UpdateGeneratedFiles;
      $(CoreCompileDependsOn);
    </CoreCompileDependsOn>
    <DeferredBuildDependsOn>
      $(DeferredBuildDependsOn);
      UpdateAndroidResources;
    </DeferredBuildDependsOn>
    <PrepareForRunDependsOn>
      $(PrepareForRunDependsOn);
      _CollectMonoAndroidOutputs;
    </PrepareForRunDependsOn>
    <CleanDependsOn>
      $(CleanDependsOn);
      _CleanMonoAndroidIntermediateDir;
      _CleanAndroidBuildPropertiesCache;
      _CleanAarCache;
      CleanBindingsOutput;
      CleanLibraryProjectIntermediaries;
      CleanNativeLibraryIntermediaries;
      _CleanAndroidGradleProjects;
    </CleanDependsOn>
    <ExportJarToXmlDependsOnTargets>
      _ResolveMonoAndroidSdks;
      ResolveAssemblyReferences;
      _ExtractLibraryProjectImports;
      _GetLibraryImports;
      _ExtractAar;
      _CollectJavaSourceForBinding;
      _ExportJarToXml;
    </ExportJarToXmlDependsOnTargets>
    <GetAndroidDependenciesDependsOn>
      _BeforeGetAndroidDependencies;
      _SetLatestTargetFrameworkVersion;
      _ResolveSdks;
      _ResolveAndroidTooling;
      $(GetAndroidDependenciesDependsOn);
    </GetAndroidDependenciesDependsOn>
    <_ResolveLibraryProjectsDependsOn>
      _ExtractAar;
    </_ResolveLibraryProjectsDependsOn>
    <_CompileBindingJavaDependsOnTargets>
      _AdjustJavacVersionArguments;
      _GetLibraryImports;
      _DetermineBindingJavaLibrariesToCompile;
      _GetJavaPlatformJar;
    </_CompileBindingJavaDependsOnTargets>
    <_IncludeAarInNuGetPackageDependsOn>
      _BuildAndroidGradleProjects;
      _CategorizeAndroidLibraries;
    </_IncludeAarInNuGetPackageDependsOn>
  </PropertyGroup>

</Project>
