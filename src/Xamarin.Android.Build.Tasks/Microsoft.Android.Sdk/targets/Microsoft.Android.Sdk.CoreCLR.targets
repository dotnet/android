<!--
***********************************************************************************************
Microsoft.Android.Sdk.CoreCLR.targets

This file contains the CoreCLR-specific MSBuild logic for .NET for Android.
***********************************************************************************************
-->
<Project>

  <!-- Default property values for CoreCLR -->
  <PropertyGroup>
    <_AndroidRuntimePackRuntime>CoreCLR</_AndroidRuntimePackRuntime>
  </PropertyGroup>
  <!-- Properties for $(OutputType)=Exe (Android Applications) -->
  <PropertyGroup Condition=" '$(AndroidApplication)' == 'true' ">
    <!--
      Enable R2R by default for CoreCLR applications:
      - Release builds: Use composite R2R for best startup performance
      - Debug builds: Use individual R2R to improve runtime performance while debugging
      Set PublishReadyToRun=false to disable R2R compilation.
    -->
    <PublishReadyToRun Condition=" '$(PublishReadyToRun)' == '' ">true</PublishReadyToRun>
    <!-- Composite R2R only for Release builds - it's slower to compile but faster at runtime -->
    <PublishReadyToRunComposite Condition=" '$(PublishReadyToRunComposite)' == '' and '$(PublishReadyToRun)' == 'true' and '$(Configuration)' == 'Release' ">true</PublishReadyToRunComposite>
    <_IsPublishing Condition=" '$(_IsPublishing)' == '' and '$(PublishReadyToRun)' == 'true' ">true</_IsPublishing>
    <AllowReadyToRunWithoutRuntimeIdentifier Condition=" '$(PublishReadyToRun)' == 'true' and '$(RuntimeIdentifiers)' != '' ">true</AllowReadyToRunWithoutRuntimeIdentifier>
  </PropertyGroup>

  <!-- Default feature switches -->
  <ItemGroup>
    <RuntimeHostConfigurationOption Include="Microsoft.Android.Runtime.RuntimeFeature.IsMonoRuntime"
        Value="false"
        Trim="true"
    />
    <RuntimeHostConfigurationOption Include="Microsoft.Android.Runtime.RuntimeFeature.IsCoreClrRuntime"
        Value="true"
        Trim="true"
    />
  </ItemGroup>

  <Target Name="_CLRUseLocalRuntimePacks" AfterTargets="ResolveFrameworkReferences"
          Condition=" '$(_CLRLocalRuntimePath)' != '' And '$(_AndroidRuntime)' == 'CoreCLR' ">
    <PropertyGroup>
      <_DotNetRuntimeRepo>$(_CLRLocalRuntimePath)</_DotNetRuntimeRepo>
      <_DotNetRuntimeConfiguration Condition=" '$(_DotNetRuntimeConfiguration)' == '' ">Release</_DotNetRuntimeConfiguration>
    </PropertyGroup>
    <ItemGroup>
      <!-- update runtime pack to local build -->
      <ResolvedRuntimePack
          PackageDirectory="$(_DotnetRuntimeRepo)/artifacts/bin/microsoft.netcore.app.runtime.$(RuntimeIdentifier)/$(_DotNetRuntimeConfiguration)"
          Condition=" '%(ResolvedRuntimePack.FrameworkName)' == 'Microsoft.NETCore.App' And Exists('$(_DotnetRuntimeRepo)/artifacts/bin/microsoft.netcore.app.runtime.$(RuntimeIdentifier)/$(_DotNetRuntimeConfiguration)') " />
    </ItemGroup>
  </Target>
</Project>
