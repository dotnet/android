parameters:
  releaseImage: false    # 'true' to release a specific emulator, if 'true', other 'release*' parameters must be provided
  releaseDeviceName:     # Device name to release, like 'wear_square'
  releaseAvdApiLevel:    # Device API level to release, like '30'
  releaseAvdAbi:         # Device ABI to release, like 'x86'
  releaseAvdType:        # Device AVD to release, like 'android-wear'

steps:
# This uses our in-tree 'dotnet' because the system one may not have the 'android' workload installed.
- template: run-dotnet-preview.yaml
  parameters:
    displayName: Shut down emulator
    condition: always()
    continueOnError: true
    project: tests/Mono.Android-Tests/Runtime-Microsoft.Android.Sdk/Mono.Android.NET-Tests.csproj
    ${{ if eq(parameters.releaseImage, true) }}:
      arguments: -c $(XA.Build.Configuration) -t:"AcquireAndroidTarget,ReleaseAndroidTarget" -p:TestDeviceName=${{ parameters.releaseDeviceName }} -p:TestAvdApiLevel=${{ parameters.releaseAvdApiLevel }} -p:TestAvdAbi=${{ parameters.releaseAvdAbi }} -p:TestAvdType=${{ parameters.releaseAvdType }} -bl:$(System.DefaultWorkingDirectory)/bin/Test$(XA.Build.Configuration)/shutdown-emulator.binlog
    ${{ else }}:
      arguments: -c $(XA.Build.Configuration) -t:"AcquireAndroidTarget,ReleaseAndroidTarget" -bl:$(System.DefaultWorkingDirectory)/bin/Test$(XA.Build.Configuration)/shutdown-emulator.binlog
