<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Prepare" ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <_TopDir>$(MSBuildThisFileDirectory)..\..</_TopDir>
    <_NuGet>.nuget\NuGet.exe</_NuGet>
  </PropertyGroup>
  <ItemGroup>
    <_ConfigurationFile Include="Windows-Configuration.OperatingSystem.props">
      <Destination>$(_TopDir)\Configuration.OperatingSystem.props</Destination>
    </_ConfigurationFile>
    <_ConfigurationFile Include="Configuration.Java.Interop.Override.props">
      <Destination>$(_TopDir)\external\Java.Interop\Configuration.Override.props</Destination>
    </_ConfigurationFile>
  </ItemGroup>
  <UsingTask AssemblyFile="$(_TopDir)\bin\Build$(Configuration)\xa-prep-tasks.dll" TaskName="Xamarin.Android.BuildTools.PrepTasks.JdkInfo" />
  <Target Name="Prepare">
    <Exec Command="git submodule update --init --recursive" WorkingDirectory="$(_TopDir)" />
    <Copy
        SourceFiles="@(_ConfigurationFile)"
        DestinationFiles="@(_ConfigurationFile->'%(Destination)')"
        SkipUnchangedFiles="True"
    />
    <MSBuild Projects="$(MSBuildThisFileDirectory)..\xa-prep-tasks\xa-prep-tasks.csproj" />
    <JdkInfo
        AndroidSdkPath="$(AndroidSdkPath)"
        AndroidNdkPath="$(AndroidNdkPath)"
        JavaSdkPath="$(JavaSdkDirectory)"
        Output="$(_TopDir)\external\Java.Interop\bin\BuildDebug\JdkInfo.props"
    />
    <Exec Command="$(_NuGet) restore Xamarin.Android.sln" WorkingDirectory="$(_TopDir)" />
    <Exec Command="$(_NuGet) restore external\Java.Interop\Java.Interop.sln" WorkingDirectory="$(_TopDir)" />
    <Exec Command="$(_NuGet) restore external\LibZipSharp\libZipSharp.sln" WorkingDirectory="$(_TopDir)" />
  </Target>
</Project>