<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Target Name="GenerateJavaCallableWrappers"
      AfterTargets="$(JavaCallableWrapperAfterTargets)"
      Inputs="$(JavaCallableWrapperAbsAssembly);@(JavaCallableWrapperSource)"
      Outputs="$(OutputPath)mono.android.jar">
    <MakeDir Directories="$(IntermediateOutputPath)jcw;$(IntermediateOutputPath)jcw\bin" />
    <PropertyGroup>
      <OutputPathAbs Condition="$([System.IO.Path]::IsPathRooted($(OutputPath)))">$(OutputPath)</OutputPathAbs>
      <OutputPathAbs Condition=" '$(OutputPathAbs)' == '' ">$(MSBuildProjectDirectory)\$(OutputPath)</OutputPathAbs>
      <JcwGen>"$(XAInstallPrefix)xbuild\Xamarin\Android\jcw-gen.exe" -v10</JcwGen>
      <_LibDirs>-L "$(OutputPathAbs.TrimEnd('\'))" -L "$(OutputPathAbs)..\v1.0" -L "$(OutputPathAbs)..\v1.0\Facades"</_LibDirs>
      <_Out>-o "$(MSBuildProjectDirectory)\$(IntermediateOutputPath)jcw\src"</_Out>
    </PropertyGroup>
    <Exec
        Command="$(ManagedRuntime) $(ManagedRuntimeArgs) $(JcwGen) $(_Out) $(_LibDirs) &quot;$(JavaCallableWrapperAbsAssembly)&quot;"
    />
    <ItemGroup>
      <_JavaSources Include="$(IntermediateOutputPath)jcw\src\**\*.java" />
      <_JavaSources Include="$(JavaInteropSourceDirectory)\src\Java.Interop\java\com\xamarin\**\*.java" />
    </ItemGroup>
    <WriteLinesToFile
        File="$(IntermediateOutputPath)jcw\classes.txt"
        Lines="@(JavaCallableWrapperSource);@(_JavaSources)"
        Overwrite="True"
    />
    <PropertyGroup>
      <_Target>-source $(JavacSourceVersion) -target $(JavacSourceVersion)</_Target>
      <_D>-d "$(IntermediateOutputPath)jcw\bin"</_D>
      <_AndroidJar>"$(AndroidToolchainDirectory)\sdk\platforms\android-$(AndroidPlatformId)\android.jar"</_AndroidJar>
      <_MonoAndroidJar>$(OutputPath)mono.android.jar</_MonoAndroidJar>
      <_MonoAndroidRuntimeJar>$(OutputPath)..\..\..\xbuild\Xamarin\Android\java_runtime.jar</_MonoAndroidRuntimeJar>
    </PropertyGroup>
    <Exec
        Command="&quot;$(JavaCPath)&quot; $(_Target) $(_D) -bootclasspath $(_AndroidJar)$(PathSeparator)&quot;$(_MonoAndroidJar)&quot;$(PathSeparator)&quot;$(_MonoAndroidRuntimeJar)&quot; @$(IntermediateOutputPath)jcw\classes.txt"
    />
    <Exec
        Condition="Exists('$(_MonoAndroidJar)')"
        Command="&quot;$(JarPath)&quot; uf &quot;$(_MonoAndroidJar)&quot; -C &quot;$(IntermediateOutputPath)jcw\bin&quot; ."
    />
    <Exec
        Condition="!Exists('$(_MonoAndroidJar)')"
        Command="&quot;$(JarPath)&quot; cf &quot;$(_MonoAndroidJar)&quot; -C &quot;$(IntermediateOutputPath)jcw\bin&quot; ."
    />
  </Target>
  <Target Name="_GenerateMonoAndroidDex16"
      AfterTargets="GenerateJavaCallableWrappers"
      Inputs="$(OutputPath)mono.android.jar"
      Outputs="$(OutputPath)mono.android.dex">
    <Exec
        Command="&quot;$(AndroidSdkDirectory)\build-tools\$(XABuildToolsFolder)\dx&quot; --dex --no-strict --output=&quot;$(OutputPath)mono.android.dex&quot; &quot;$(OutputPath)mono.android.jar&quot;"
        EnvironmentVariables="JAVA_HOME=$(JavaSdkDirectory)"
    />
  </Target>
</Project>
