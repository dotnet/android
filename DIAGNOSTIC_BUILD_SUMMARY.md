# Diagnostic Build Summary: Assembly Item Groups in NativeAOT for Android

## Build Command Executed
```bash
./dotnet-local.sh build samples/NativeAOT/NativeAOT.csproj -c Release -t:_AndroidComputeIlcCompileInputs
```

## Key Target File
`/bin/Release/lib/packs/Microsoft.Android.Sdk.Darwin/36.1.99/targets/Microsoft.Android.Sdk.NativeAOT.targets`

## Assembly Item Groups in NativeAOT Pipeline

### 1. **ManagedAssemblyToLink**
- **Source**: .NET SDK standard item group for assemblies to be processed by ILLink
- **Usage in NativeAOT**:
  - Line 100: `<_AndroidAssembliesForIlc Include="@(ManagedAssemblyToLink)" />`
  - Contains all managed assemblies that ILLink would normally process
  - For NativeAOT, these are passed **untrimmed** directly to ILC (ILC does its own trimming)
  - Can include TypeMap-generated assembly (line 69 in ILLink.targets)
- **Note**: `ManagedAssemblyToLink` is populated by the .NET SDK's standard linking targets

### 2. **RuntimePackAsset**
- **Source**: Runtime pack assets from the NativeAOT runtime package
- **Usage in NativeAOT**:
  - Line 104: `<_AndroidNativeAotRuntimeAsset Include="@(RuntimePackAsset)" Condition="'%(Filename)' == 'Microsoft.Android.Runtime.NativeAOT'" />`
  - Filters for the specific Android NativeAOT runtime assembly
  - Line 117: Also used to find native libraries: `libnaot-android.$(Configuration.ToLower())-static-$(Configuration.ToLower())`
  - Added to `_AndroidAssembliesForIlc` for ILC reference
- **Content**: Android-specific NativeAOT runtime assembly and native libraries

### 3. **PrivateSdkAssemblies**
- **Source**: .NET SDK's private SDK assemblies
- **Usage in NativeAOT**:
  - Line 108: `<IlcReference Include="@(PrivateSdkAssemblies)" />`
  - Added to `IlcReference` item group (reference-only, not compiled)
  - These are SDK reference assemblies used during ILC compilation
- **Note**: `PrivateSdkAssemblies` is a .NET SDK standard item group

### 4. **IlcCompileInput** (Computed)
- **Purpose**: Assemblies to be compiled by ILC
- **Populated in `_AndroidComputeIlcCompileInputs` target**:
  - Line 96: Remove all existing IlcCompileInput items
  - Line 97: Add the main app assembly from outer build: `$(_OuterIntermediateOutputPath)$(TargetName)$(TargetExt)`
  - Line 112: Also added to ResolvedFileToPublish: `@(IlcCompileInput);@(_AndroidAssembliesForIlc)`

### 5. **IlcReference** (Computed)
- **Purpose**: Reference assemblies for ILC (not compiled, only used for type resolution)
- **Populated in `_AndroidComputeIlcCompileInputs` target**:
  - Line 107: Remove all existing IlcReference items
  - Line 108: Add all `PrivateSdkAssemblies`
  - Line 109: Add all `_AndroidAssembliesForIlc` (which includes ManagedAssemblyToLink + Android runtime)

### 6. **_AndroidAssembliesForIlc** (Internal)
- **Purpose**: Intermediate item group collecting all managed assemblies for Android NativeAOT
- **Populated in `_AndroidComputeIlcCompileInputs` target**:
  - Line 100: Add `@(ManagedAssemblyToLink)`
  - Line 102: Add TypeMap assembly if enabled: `@(_TypeMapGeneratedAssembly)` 
  - Line 105: Add Android NativeAOT runtime assembly: `@(_AndroidNativeAotRuntimeAsset)`
- **Used by**:
  - Line 109: Added to `IlcReference`
  - Line 112: Added to `ResolvedFileToPublish`

### 7. **_TypeMapGeneratedAssembly** (Generated)
- **Source**: Generated by `_GenerateTypeMapAssembly` target
- **When enabled**: `$(AndroidEnableTypeMaps)` == 'true'
- **Usage**:
  - Line 102: Added to `_AndroidAssembliesForIlc` if enabled
  - Generated by scanning assemblies for `[Register]` attributes
- **Related targets**: `Microsoft.Android.Sdk.ILLink.targets` (lines 20-87)

### 8. **UnmanagedEntryPointsAssembly**
- **Usage**: Line 92
- **Value**: `Microsoft.Android.Runtime.NativeAOT`
- **Purpose**: Required for `[UnmanagedCallersOnly]` to work inside this assembly

## Assembly Flow Diagram

```
ILLink/Standard SDK targets
    ├─ ManagedAssemblyToLink
    ├─ PrivateSdkAssemblies
    └─ _TypeMapGeneratedAssembly (if AndroidEnableTypeMaps==true)
           ↓
_AndroidComputeIlcCompileInputs target
    ├─ IlcCompileInput ← app assembly
    ├─ _AndroidAssembliesForIlc
    │   ├─ @(ManagedAssemblyToLink)
    │   ├─ @(_TypeMapGeneratedAssembly)
    │   └─ @(RuntimePackAsset) [Microsoft.Android.Runtime.NativeAOT only]
    ├─ IlcReference
    │   ├─ @(PrivateSdkAssemblies)
    │   └─ @(_AndroidAssembliesForIlc)
    └─ ResolvedFileToPublish
        ├─ @(IlcCompileInput)
        └─ @(_AndroidAssembliesForIlc)
```

## Key Characteristics for NativeAOT

1. **No ILLink Processing**: Line 76 sets `<RunILLink>false</RunILLink>` 
   - ILC handles all trimming itself, receives untrimmed assemblies

2. **RuntimePackAsset Filtering**: Only `Microsoft.Android.Runtime.NativeAOT` is used (line 104)
   - Not just any RuntimePackAsset, specifically the NativeAOT variant

3. **Separate App Assembly**: Uses outer build's app assembly via `_OuterIntermediateOutputPath`
   - Indicates this is a per-RID build with different handling than outer build

4. **TypeMaps Support**: Optional TypeMap assembly can be included (line 102)
   - Helps ILC with type mapping decisions during trimming
