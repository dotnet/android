<Project Sdk="Microsoft.NET.Sdk" >
  <Import Project="..\..\Configuration.props" />

  <PropertyGroup>
    <TargetFramework>net6.0-android</TargetFramework>
    <TargetFrameworkVersion>$(AndroidFrameworkVersion)</TargetFrameworkVersion>
    <RootNamespace>Xamarin.Android.Net.Tests</RootNamespace>
    <AssemblyName>Xamarin.Android.Net_Tests</AssemblyName>
    <OutputType>Library</OutputType>
    <AppDesignerFolder>Properties</AppDesignerFolder>
    <GenerateSerializationAssemblies>Off</GenerateSerializationAssemblies>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <SignAssembly>true</SignAssembly>
    <AssemblyOriginatorKeyFile>..\..\product.snk</AssemblyOriginatorKeyFile>
    <OutputPath>..\..\bin\Test$(Configuration)</OutputPath>
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
    <EnableDefaultCompileItems>false</EnableDefaultCompileItems>
    <EnableDefaultAndroidResourceItems>false</EnableDefaultAndroidResourceItems>
    <EnableDefaultAndroidAssetItems>false</EnableDefaultAndroidAssetItems>
    <IntermediateOutputPath>obj/$(Configuration)/$(TargetFramework.ToLowerInvariant())/android/</IntermediateOutputPath>
  </PropertyGroup>

  <PropertyGroup>
    <_MonoAndroidTestPackage>Xamarin.Android.Net_Tests</_MonoAndroidTestPackage>
    <Nullable>enable</Nullable>
    <WarningsAsErrors>IL2037</WarningsAsErrors>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(Configuration)' == 'Release' ">
    <AndroidLinkTool Condition=" '$(AndroidLinkTool)' == '' ">r8</AndroidLinkTool>
  </PropertyGroup>

  <ItemGroup>
    <Reference Include="System" />
    <Reference Include="System.Net.Http" />
    <Reference Include="Mono.Android" />
    <Reference Include="Xamarin.Android.NUnitLite" />
  </ItemGroup>

  <ItemGroup>
    <Compile Include="ServerCertificateCustomValidationCallbackTest.cs" />
    <Compile Include="MainActivity.cs" />
    <Compile Include="Resources\Resource.designer.cs" />
    <Compile Include="Properties\AssemblyInfo.cs" />
    <Compile Include="TestInstrumentation.cs" />
  </ItemGroup>

  <ItemGroup>
    <None Include="Resources\AboutResources.txt" />
    <None Include="Assets\AboutAssets.txt" />
    <None Include="Properties\AndroidManifest.xml" />
  </ItemGroup>

  <ItemGroup>
    <TestApk Include="..\..\bin\Test$(Configuration)\Xamarin.Android.Net_Tests-Signed.$(AndroidPackageFormat)">
      <Package>Xamarin.Android.Net_Tests</Package>
      <TimingDefinitionsFilename>$(MSBuildThisFileDirectory)..\..\build-tools\scripts\TimingDefinitions.txt</TimingDefinitionsFilename>
      <TimingResultsFilename>$(MSBuildThisFileDirectory)..\..\TestResult-Xamarin.Android.Net_Tests-times.csv</TimingResultsFilename>
    </TestApk>

    <TestApkInstrumentation Include="xamarin.android.net.tests.TestInstrumentation">
      <Package>Xamarin.Android.Net_Tests</Package>
      <ResultsPath>..\..\bin\Test$(Configuration)\TestResult-Xamarin.Android.Net_Tests.xml</ResultsPath>
    </TestApkInstrumentation>
  </ItemGroup>

  <!-- <ItemGroup Condition=" '$(AndroidPackageFormat)' != 'aab' ">
    <TestApk Include="$(OutputPath)$(_MonoAndroidTestPackage)-Signed.apk">
      <Package>$(_MonoAndroidTestPackage)</Package>
      <InstrumentationType>xamarin.android.runtimetests.NUnitInstrumentation</InstrumentationType>
      <ResultsPath>$(OutputPath)TestResult-$(_MonoAndroidTestPackage).xml</ResultsPath>
      <TimingDefinitionsFilename>$(XamarinAndroidSourcePath)build-tools\scripts\TimingDefinitions.txt</TimingDefinitionsFilename>
      <TimingResultsFilename>$(OutputPath)TestResult-$(_MonoAndroidTestPackage)-times.csv</TimingResultsFilename>
      <ApkSizesInputFilename>apk-sizes-$(_MonoAndroidTestPackage)-$(Configuration)$(TestsFlavor).txt</ApkSizesInputFilename>
      <ApkSizesDefinitionFilename>$(XamarinAndroidSourcePath)build-tools\scripts\ApkSizesDefinitions.txt</ApkSizesDefinitionFilename>
      <ApkSizesResultsFilename>$(OutputPath)TestResult-$(_MonoAndroidTestPackage)-values-$(Configuration).csv</ApkSizesResultsFilename>
    </TestApk>
  </ItemGroup>

  <ItemGroup Condition=" '$(AndroidPackageFormat)' == 'aab' ">
    <TestAab Include="$(OutputPath)$(_MonoAndroidTestPackage)-Signed.aab">
      <Package>$(_MonoAndroidTestPackage)</Package>
      <InstrumentationType>xamarin.android.runtimetests.NUnitInstrumentation</InstrumentationType>
      <ResultsPath>$(OutputPath)TestResult-$(_MonoAndroidTestPackage).xml</ResultsPath>
      <TimingDefinitionsFilename>$(XamarinAndroidSourcePath)build-tools\scripts\TimingDefinitions.txt</TimingDefinitionsFilename>
      <TimingResultsFilename>$(OutputPath)TestResult-$(_MonoAndroidTestPackage)-times.csv</TimingResultsFilename>
      <ApkSizesInputFilename>apk-sizes-$(_MonoAndroidTestPackage)-$(Configuration)$(TestsFlavor).txt</ApkSizesInputFilename>
      <ApkSizesDefinitionFilename>$(XamarinAndroidSourcePath)build-tools\scripts\ApkSizesDefinitions.txt</ApkSizesDefinitionFilename>
      <ApkSizesResultsFilename>$(OutputPath)TestResult-$(_MonoAndroidTestPackage)-values-$(Configuration).csv</ApkSizesResultsFilename>
    </TestAab>
  </ItemGroup> -->

  <Import Project="$(XamarinAndroidSourcePath)build-tools\scripts\TestApks.targets" />
  <Import Project="$(MSBuildExtensionsPath)\Xamarin\Android\Xamarin.Android.CSharp.targets" />
</Project>
